<div class="payment-form klarna-installment-form" id="klarnaInstallment">
    <h3>Afbetaling</h3>
    <h3>Konto - Betal i dit eget tempo</h3>

    <span id="ratexx"></span>

    <script src="https://cdn.klarna.com/public/kitt/core/v1.0/js/klarna.min.js"></script>
    <script src="https://cdn.klarna.com/public/kitt/toc/v1.1/js/klarna.terms.min.js"></script>

    <script>
        new Klarna.Terms.Account({
            el: 'ratexx',
            eid: '{{ form.klarna_installment.vars.attr.EID }}',
            locale: 'da_dk',
            charge: 0,
            type: 'desktop'
        });
    </script>

    {% include '@klarna/errorInstallment.twig' %}

    <div id="paymentForm_klarna_installment">
        {% for key, formRow in form.klarna_installment.children %}
            <div>
                {% if formRow.vars.name == 'installment_pay_index' %}
                    <div id="paymentForm_klarna_installment_installment_pay_index">
                        {% for keyPayIndex, rowPayIndex in formRow.children %}

                            {{ form_widget(rowPayIndex) }}

                            {% for payment in form.klarna_installment.vars.installmentResponseTransfer.payments  if rowPayIndex.vars.value == payment.id %}

                                {% if payment.getType == 1 %}
                                    {# KlarnaPClass::ACCOUNT #}
                                    <label>Konto - Betal i dit eget tempo</label>
                                    <table class="paymentDescription">
                                        <tr>
                                            <td>Rørlig årsrente</td>
                                            <td>{{ payment.getInterestRate }} %</td>
                                        </tr>
                                        <tr>
                                            <td>Oprettelsegebyr</td>
                                            <td>{{ payment.getStartFee }} kr.</td>
                                        </tr>
                                        <tr>
                                            <td>Administrationsgebyr</td>
                                            <td>{{ payment.getInvoiceFee }} kr./md</td>
                                        </tr>
                                        <tr>
                                            <td>Delbetala fra</td>
                                            <td>{{ payment.getMonthlyCosts }} kr./md</td>
                                        </tr>
                                    </table>

                                    <div>
                                        Lad os sige, at du køber for 10.000 kr.
                                        Administrativt gebyr er 39 kr./md., og rørlig
                                        årsrente er 22,70 %. Du betaler 978 kr. af
                                        hver måned i 12 mdr. Den årlige effektive
                                        rente bliver da 35,41 %,
                                        kreditomkostningerne 1740 kr og
                                        kreditkøbspris bliver 11.740 kr.
                                    </div><br/>

                                {% else %}

                                    <label>{{ payment.getMonthlyCosts }} kr/måned i {{ payment.getMonth }} måneder</label>
                                    <table class="paymentDescription">
                                        <tr>
                                            <td>Fast årlig rente</td>
                                            <td>{{ payment.getInterestRate }} %</td>
                                        </tr>
                                        <tr>
                                            <td>Oprettelsegebyr</td>
                                            <td>{{ payment.getStartFee }} kr.</td>
                                        </tr>
                                        <tr>
                                            <td>Administrationsgebyr</td>
                                            <td>{{ payment.getInvoiceFee }} kr./md</td>
                                        </tr>
                                        <tr>
                                            <td>Månedlig omkostning</td>
                                            <td>{{ payment.getMonthlyCosts }} kr./md</td>
                                        </tr>
                                        <tr>
                                            <td>Effektiv rente</td>
                                            <td>{{ payment.getApr }} %</td>
                                        </tr>
                                        <tr>
                                            <td>Kreditomkostningerne</td>
                                            <td>{{ (payment.getTotalCreditPurchaseCost - form.klarna_installment.vars.attr.grandTotal) | round(2) }} kr.</td>
                                        </tr>
                                        <tr>
                                            <td>Kreditkøbspris</td>
                                            <td>{{ payment.getTotalCreditPurchaseCost }} kr.</td>
                                        </tr>
                                    </table>
                                {% endif %}
                               <hr/>
                            {% endfor %}

                        {% endfor %}
                    </div>
                {% else %}
                    {{ form_label(formRow) }}
                    {{ form_widget(formRow) }}
                {% endif %}
            </div>
        {% endfor %}
    </div>



</div>
<script>
    var errorMsgDateBirthMandatory = "Født er påkrævet";
    var errorMsgDateBirthWrong = "False fødsel";
    var errorMsgPNOMandatory = "PNO er påkrævet";
    var errorMsgTermsMandatory = "Betingelser er påkrævet";
    var errorMsgPaymentTypeMandatory = "Betaling kræves";
</script>
